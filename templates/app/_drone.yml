
build:
  compile:
    image: node:6.3.1
    pull: true
    commands:
      - npm update
      - npm run build

<% if(dockerhubRepo != '' || publishNPM == true){ %>
publish:
  <% if(dockerhubRepo != ''){ %>
  docker:
    repo: <%=dockerhubRepo%>
    tag:
      - '<%="$${BRANCH/master/latest}"%>'
      - '$$BRANCH.$$BUILD_NUMBER'
    registry: registry.hub.docker.com
    username: $$DOCKERHUB_USER
    password: $$DOCKERHUB_PASSWORD
    email: $$DOCKERHUB_EMAIL
    storage_driver: overlay<% } %>
  <% if(publishNPM == true){ %>
  npm:
    username: $$NPM_USERNAME
    password: $$NPM_PASSWORD
    email: $$NPM_EMAIL
    registry: https://registry.npmjs.org
    always_auth: true<% } %>
<% } %>

cache:
  mount:
    - node_modules