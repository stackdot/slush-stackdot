
build:
  compile:
    image: node:6.3.1
    pull: true
    environment:
      - COVERALLS_REPO_TOKEN=$$COVERALLS_REPO_TOKEN
    commands:
      - npm update
      - npm test

<% if(dockerRepoName != '' || publishNPM == true){ %>
publish:
  <% if(dockerRepoName != ''){ %>
  docker:
    repo: <%=dockerRepoName%>
    tag:
      - '$${BRANCH/master/latest}'
      - '$$BRANCH.$$BUILD_NUMBER'
    registry: $$DOCKER_REGISTRY
    username: $$DOCKER_USER
    password: $$DOCKER_PASSWORD
    email: $$DOCKER_EMAIL
    storage_driver: overlay<% } %>
  <% if(publishNPM == true){ %>
  npm:
    username: $$NPM_USERNAME
    password: $$NPM_PASSWORD
    email: $$NPM_EMAIL
    registry: $$NPM_REGISTRY
    always_auth: $$NPM_ALWAYS_AUTH<% } %>
<% } %>

cache:
  mount:
    - node_modules